{% extends "commercial/base_commercial.html" %}

{% block title %}Mot de passe oubli√© - LocAPP{% endblock %}

{% block content %}
<div class="auth-page">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1>Mot de passe oubli√© ?</h1>
                <p>Entrez votre adresse email pour recevoir un lien de r√©initialisation</p>
            </div>

            <form id="forgotPasswordForm" class="auth-form active" onsubmit="handleForgotPassword(event)">
                <div class="form-group">
                    <label class="form-label" for="email">Adresse email</label>
                    <input type="email" class="form-control" id="email" name="email" required placeholder="votre@email.com">
                </div>

                <div id="alertContainer"></div>

                <div class="form-submit">
                    <button type="submit" class="btn btn-primary" id="submitBtn">Envoyer le lien de r√©initialisation</button>
                </div>

                <div style="text-align: center; margin-top: 1.5rem;">
                    <a href="{{ url_for('login') }}" style="color: var(--primary-color); font-size: 0.875rem;">
                        ‚Üê Retour √† la connexion
                    </a>
                </div>
            </form>

            <!-- Success State -->
            <div id="successState" style="display: none; text-align: center; padding: 2rem 0;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">üìß</div>
                <h2 style="color: var(--text-dark); margin-bottom: 1rem;">Email envoy√© !</h2>
                <p style="color: var(--text-light); margin-bottom: 2rem;">
                    Si un compte existe avec cette adresse email, vous recevrez un lien de r√©initialisation dans quelques minutes.
                </p>
                <p style="color: var(--text-light); font-size: 0.875rem;">
                    Pensez √† v√©rifier vos spams si vous ne recevez pas l'email.
                </p>
                <div style="margin-top: 2rem;">
                    <a href="{{ url_for('login') }}" class="btn btn-primary">Retour √† la connexion</a>
                </div>
            </div>
        </div>

        <p style="text-align: center; margin-top: 2rem; color: var(--text-light);">
            <a href="{{ url_for('commercial_home') }}" style="color: var(--primary-color);">‚Üê Retour √† l'accueil</a>
        </p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function handleForgotPassword(event) {
    event.preventDefault();

    const email = document.getElementById('email').value;
    const submitBtn = document.getElementById('submitBtn');
    const alertContainer = document.getElementById('alertContainer');

    submitBtn.disabled = true;
    submitBtn.textContent = 'Envoi en cours...';
    alertContainer.innerHTML = '';

    try {
        const response = await fetch('/api/auth/forgot-password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email })
        });

        const result = await response.json();

        if (response.ok) {
            // Show success state
            document.getElementById('forgotPasswordForm').style.display = 'none';
            document.getElementById('successState').style.display = 'block';
        } else {
            alertContainer.innerHTML = `<div class="alert alert-error">${result.error || 'Une erreur est survenue'}</div>`;
            submitBtn.disabled = false;
            submitBtn.textContent = 'Envoyer le lien de r√©initialisation';
        }
    } catch (error) {
        alertContainer.innerHTML = '<div class="alert alert-error">Erreur de connexion au serveur</div>';
        submitBtn.disabled = false;
        submitBtn.textContent = 'Envoyer le lien de r√©initialisation';
    }
}
</script>
{% endblock %}
